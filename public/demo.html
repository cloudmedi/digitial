<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Demo</title>
</head>
<body>
<div id="list_of">
	<button class="join">Rest Ping</button>
	<button class="ping">Socket Ping</button>
	<button class="screens">Screens</button>
</div>
<div id="res"></div>
<div class="row" id="tables">

</div>

<ul id="list">

</ul>
<!-- Scripts -->
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"
		integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI"
		crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.6.1.min.js" crossorigin="anonymous"></script>
<script>
	(() => {
		const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY2NGU0ZDIwNTgwNWQ1MzAxZDUxNWM5NyIsInVzZXJuYW1lIjoiQWx5c3Nvbl9SeWFuIiwiaXNfbWVyY2hhbnQiOmZhbHNlLCJpc19hZG1pbiI6ZmFsc2UsInN1YnNjcmlwdGlvbiI6IjY1ZmVmY2QyMmM3N2E4NTBlNDdjMWUzNiIsInN1YnNjcmlwdGlvbl9leHBpcmUiOiIyMDI0LTA1LTI5VDE5OjUzOjA0LjM3MloiLCJleHAiOjE3MjIyNzg3NDAsImlhdCI6MTcxNzA5NDc0MH0.2Tga_NBpj8x18SmNL3X3_KVYkAgWlFgMYQclmCIx5jc";
		const socket = io("http://0.0.0.0:3001", {
			reconnectionDelayMax: 10000,
			upgrades: ["websocket"],
			auth: {
				token: token
			},
			query: {
				"token": token
			}
		});

		socket.on("connect", () => {
			console.log("connected with:", socket.id);
		});

		socket.on("disconnect", () => {
			console.log("disconnected",socket.id); // undefined
		});

		socket.onAny((eventName, ...args) => {
			let room = args[0];
			console.log(eventName, args);
		});

		$(".join").on("click", (el) => {
			let settings = {
				"url": "http://0.0.0.0:4001/api/ping",
				"method": "GET",
				"timeout": 0,
				"headers": {
					"Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY2NGU0ZDIwNTgwNWQ1MzAxZDUxNWM5NyIsInVzZXJuYW1lIjoiQWx5c3Nvbl9SeWFuIiwiaXNfbWVyY2hhbnQiOmZhbHNlLCJpc19hZG1pbiI6ZmFsc2UsInN1YnNjcmlwdGlvbiI6IjY1ZmVmY2QyMmM3N2E4NTBlNDdjMWUzNiIsInN1YnNjcmlwdGlvbl9leHBpcmUiOiIyMDI0LTA1LTI5VDE5OjUzOjA0LjM3MloiLCJleHAiOjE3MjI1OTA3MDAsImlhdCI6MTcxNzQwNjcwMH0.9kcDYLiPdnW6FV5OhUdONw5hTk7bW7w-Vgvpv0Vv9Y4",
					"Content-Type": "application/json"
				},
				"data": {
					"users_devices": "user-664e4d205805d5301d515c97-devices",
					"device": "device-664e4d6817c4cc3060144bd0"
				},
			};

			$.ajax(settings).done(function (response) {
				console.log(response);
			});
		});

		$(".ping").on("click", (el) => {
			socket.emit('call', 'users.ping', function(err, res){
				if(err){
					alert(JSON.stringify(err))
				}else{
					console.log(res);
					document.getElementById("res").textContent += 'Join room success'+ '\n'
				}
			})
		});

		$(".screens").on("click", (el) => {
			socket.emit('call', 'v1.screen.list', {token: token}, function(err, res){
				if(err){
					alert(JSON.stringify(err))
				}else{
					console.log(res);
					document.getElementById("res").textContent += 'Join room success'+ '\n'
				}
			})
		});
	})();

</script>

</body>
</html>
